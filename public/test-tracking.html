<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test du Suivi - R√©clamations</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .test-info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
        .test-button {
            background: #4caf50;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            margin: 0.5rem;
            font-size: 0.9rem;
        }
        .test-button:hover {
            background: #45a049;
        }
        .debug-info {
            background: #f5f5f5;
            border: 1px solid #ddd;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-family: monospace;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-container">
            <div class="logo">
                <h1>üß™ Test du Suivi</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="suivi.html">Retour au Suivi</a></li>
                    <li><a href="test.html">Tests Complets</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container">
        <h1 style="text-align: center; margin: 2rem 0; color: #333;">üß™ Test du Syst√®me de Suivi</h1>
        
        <div class="test-info">
            <h3>üìã Instructions de Test</h3>
            <p>Cette page permet de tester le syst√®me de suivi sans avoir besoin du backend Laravel.</p>
            <ol>
                <li>Cliquez sur "Tester avec Donn√©es Simul√©es" pour voir le fonctionnement</li>
                <li>V√©rifiez que la timeline de statut s'affiche correctement</li>
                <li>V√©rifiez que les d√©tails de la r√©clamation sont affich√©s</li>
                <li>V√©rifiez que l'historique et les r√©ponses sont visibles</li>
            </ol>
        </div>

        <div class="test-section">
            <h2>1. Test avec Donn√©es Simul√©es</h2>
            <p>Test du syst√®me de suivi avec des donn√©es de test pr√©d√©finies</p>
            <button class="test-button" onclick="testWithMockData()">Tester avec Donn√©es Simul√©es</button>
            <div id="mock-test-result"></div>
        </div>

        <div class="test-section">
            <h2>2. Test de l'API Backend</h2>
            <p>Test de la connexion avec le serveur Laravel r√©el</p>
            <button class="test-button" onclick="testRealAPI()">Tester l'API R√©elle</button>
            <div id="real-api-test-result"></div>
        </div>

        <div class="test-section">
            <h2>3. Test de Validation des Donn√©es</h2>
            <p>V√©rification de la gestion des donn√©es manquantes ou invalides</p>
            <button class="test-button" onclick="testDataValidation()">Tester la Validation</button>
            <div id="validation-test-result"></div>
        </div>

        <div class="test-section">
            <h2>üìä Informations de D√©bogage</h2>
            <div id="debug-info" class="debug-info">
                <p>Cliquez sur les boutons de test pour voir les informations de d√©bogage...</p>
            </div>
        </div>

        <!-- Section de r√©sultats du suivi (initialement cach√©e) -->
        <div id="tracking-results" class="status-container" style="display: none;">
            <div class="status-header">
                <h2>Statut de votre r√©clamation</h2>
                <p>R√©f√©rence: <strong id="complaint-reference"></strong></p>
            </div>
            
            <div class="status-timeline" id="status-timeline">
                <!-- Timeline sera g√©n√©r√© dynamiquement -->
            </div>
            
            <div class="complaint-details" id="complaint-details">
                <!-- D√©tails seront g√©n√©r√©s dynamiquement -->
            </div>
        </div>
        
        <!-- Section historique (initialement cach√©e) -->
        <div id="history-section" class="history-section" style="display: none;">
            <h2>Historique du traitement</h2>
            <div id="history-timeline">
                <!-- Historique sera g√©n√©r√© dynamiquement -->
            </div>
        </div>
        
        <!-- Section des r√©ponses (initialement cach√©e) -->
        <div id="responses-section" class="responses-section" style="display: none;">
            <h2>R√©ponses et communications</h2>
            <div id="responses-list">
                <!-- R√©ponses seront g√©n√©r√©es dynamiquement -->
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
    <script>
        function updateDebugInfo(message) {
            const debugInfo = document.getElementById('debug-info');
            const timestamp = new Date().toLocaleTimeString();
            debugInfo.innerHTML += `<p>[${timestamp}] ${message}</p>`;
            debugInfo.scrollTop = debugInfo.scrollHeight;
        }

        function testWithMockData() {
            updateDebugInfo('üß™ D√©but du test avec donn√©es simul√©es');
            
            // Simuler une r√©clamation de test
            const mockComplaint = {
                id: 1,
                reference_id: "TT-1001",
                user: { name: "Ahmed Ben Ali" },
                type: "Internet",
                subject: "Probl√®me de connexion internet",
                description: "Ma connexion internet est tr√®s lente depuis 3 jours",
                contact_info: "12345678",
                status: "En cours",
                priority: "Haute",
                assigned_agent: { name: "Karim Ben Salah" },
                created_at: "2025-01-15T10:30:00.000000Z",
                status_histories: [
                    {
                        old_status: null,
                        new_status: "Nouveau",
                        created_at: "2025-01-15T10:30:00.000000Z",
                        changed_by: { name: "Ahmed Ben Ali" },
                        notes: "R√©clamation cr√©√©e"
                    },
                    {
                        old_status: "Nouveau",
                        new_status: "En cours",
                        created_at: "2025-01-16T14:15:00.000000Z",
                        changed_by: { name: "Karim Ben Salah" },
                        notes: "R√©clamation prise en charge"
                    }
                ],
                responses: [
                    {
                        response: "Bonjour, nous avons bien re√ßu votre r√©clamation. Notre √©quipe technique va examiner le probl√®me dans les plus brefs d√©lais.",
                        created_at: "2025-01-16T14:20:00.000000Z",
                        admin: { name: "Karim Ben Salah" }
                    }
                ]
            };

            updateDebugInfo('‚úÖ Donn√©es simul√©es cr√©√©es');
            updateDebugInfo(`üìä Statut: ${mockComplaint.status}`);
            updateDebugInfo(`üìÖ Historique: ${mockComplaint.status_histories.length} entr√©es`);
            updateDebugInfo(`üí¨ R√©ponses: ${mockComplaint.responses.length} messages`);

            // Afficher les r√©sultats
            displayComplaintStatus(mockComplaint);
            
            updateDebugInfo('üéØ Test termin√© avec succ√®s');
            document.getElementById('mock-test-result').innerHTML = 
                '<div class="test-result success">‚úÖ Test avec donn√©es simul√©es r√©ussi!</div>';
        }

        function testRealAPI() {
            updateDebugInfo('üåê Test de l\'API backend en cours...');
            
            const testReference = 'TT-1001';
            updateDebugInfo(`üîç Test avec la r√©f√©rence: ${testReference}`);
            
            // Utiliser la fonction r√©elle de suivi
            trackComplaint(testReference);
            
            document.getElementById('real-api-test-result').innerHTML = 
                '<div class="test-result warning">üîÑ Test en cours... V√©rifiez la console pour les d√©tails</div>';
        }

        function testDataValidation() {
            updateDebugInfo('üîç Test de validation des donn√©es');
            
            // Test avec des donn√©es manquantes
            const incompleteComplaint = {
                reference_id: "TT-TEST",
                status: "", // Statut manquant
                priority: null, // Priorit√© manquante
                created_at: "2025-01-15T10:30:00.000000Z"
            };

            updateDebugInfo('üìä Test avec donn√©es incompl√®tes');
            updateDebugInfo(`Statut: "${incompleteComplaint.status || 'Non d√©fini'}"`);
            updateDebugInfo(`Priorit√©: "${incompleteComplaint.priority || 'Non d√©finie'}"`);

            // Tester la g√©n√©ration de timeline avec donn√©es manquantes
            try {
                generateStatusTimeline(incompleteComplaint);
                updateDebugInfo('‚úÖ Timeline g√©n√©r√©e avec donn√©es incompl√®tes');
            } catch (error) {
                updateDebugInfo(`‚ùå Erreur lors de la g√©n√©ration: ${error.message}`);
            }

            document.getElementById('validation-test-result').innerHTML = 
                '<div class="test-result success">‚úÖ Test de validation termin√©</div>';
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            updateDebugInfo('üöÄ Page de test charg√©e');
            updateDebugInfo(`üåê API Base URL: ${API_BASE_URL}`);
            updateDebugInfo('üìã Pr√™t pour les tests');
        });
    </script>
</body>
</html>
